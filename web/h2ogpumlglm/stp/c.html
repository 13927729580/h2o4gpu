<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>POGS : C++</title>
        <meta name="description" content="ADMM-based graph form solver">

        <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.no-icons.min.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/syntax.css">
        <link rel="stylesheet" href="../css/main.css">
        <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script>
    </head>
    <body>

        <div class="container">
            <div class=row-fluid>
                <div id=header class=span12>
                    <h4><a class=brand href="../index.html">POGS</a>
    <small>ADMM-based graph form solver</small>
</h4>


                </div>
            </div>

            <div class=row-fluid>
                
                
                    <div id=navigation class=span2>
                        <ul class="nav nav-list">
    <li><a href="../index.html">Home</a></li>
    <li><a href="https://github.com/foges/pogs/">GitHub</a></li>
    
        
        

        
            
                <li class=nav-header>Reference</li>
            
            <li data-order=""><a href="../ref/admm.html">ADMM</a></li>
        
            
            <li data-order=""><a href="../ref/usage.html">Usage</a></li>
        
    
        
        

        
            
                <li class=nav-header>Setup</li>
            
            <li data-order=""><a href="r.html">R</a></li>
        
            
            <li data-order=""><a href="matlab.html">MATLAB</a></li>
        
            
            <li data-order=""><a href="c.html">C++</a></li>
        
    
        
        

        
            
                <li class=nav-header>Examples</li>
            
            <li data-order=""><a href="../egs/huber-fitting.html">Huber Fitting</a></li>
        
            
            <li data-order=""><a href="../egs/linear-program.html">Linear Program</a></li>
        
            
            <li data-order=""><a href="../egs/lasso.html">Lasso</a></li>
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class=divider></li> first to break up the content. -->
</ul>

                    </div>

                    <div id=content class=span10>
                        <div class=page-header>
    <h2>C++
        
    </h2>
</div>

<h3 id="interface">Interface</h3>

<p>The C++ interface is located in the <code>&lt;pogs&gt;/src/pogs.h</code> file. To use the solver your code must include this file. The solver consists of a single function <code>Pogs</code>, with signature</p>

<pre><code class="language-cpp">template &lt;typename T, typename M&gt;
void Pogs(PogsData&lt;T, M&gt; *pogs_data);
</code></pre>

<p>The type <code>T</code> represents the data type (either <code>float</code> or <code>double</code>), and <code>M</code> is the matrix type (currently <code>float*</code> and <code>double*</code> are supported, but further types will be added for sparse matrices). <code>PogsData</code> is a struct with fields</p>

<p>Inputs</p>

<ul>
  <li><code>std::vector&lt;FunctionObj&lt;T&gt; &gt; f, g</code> correspond to the functions \( f \) and \( g \) in the objective. The dimension of <code>f</code> must be \( m \) and the dimension of <code>g</code> must be \( n \). See section below for an explanation of the <code>FunctionObj&lt;T&gt;</code> struct.</li>
  <li><code>const M A</code> corresponds to the data matrix \( A \). If \( A \) is a dense matrix, then <code>M A</code> is a pointer to a <em>row major</em> matrix of dimension \( m n \).</li>
  <li><code>size_t m, n</code> are the dimensions of \( y \), resp. \( x \).</li>
</ul>

<p>Outputs</p>

<ul>
  <li><code>T *x, *y</code> point to where the primal optimal variables \( x^\star_\text{pogs} \) and \( y^\star_\text{pogs} \) should be saved. The memory must be pre-allocated and have dimension \( m \) (resp.  \( n \)). If either <code>x=NULL</code> or <code>y=NULL</code>, then the respective variable will be discarded upon exit. <em>Note</em>, \( y^\star_\text{pogs} = A x^\star_\text{pogs} \) is only satisfied to a given tolerance (see <a href="../ref/usage.html">Usage</a>).</li>
  <li><code>T *l</code> points to where the dual optimal variable \( \lambda^\star_\text{pogs} \) should be stored. The memory must be pre-allocated and have dimension \( m \). If <code>l=NULL</code>, then the dual variable will be discarded upon exit.</li>
  <li><code>T optval</code> is the primal optimum \( p^\star_\text{pogs} = f(y^\star_\text{pogs}) + g(x^\star_\text{pogs}) \). <em>Note</em>, since \( y^\star_\text{pogs} = A x^\star_\text{pogs} \) is only satisfied to a specified tolerance, <code>optval</code> may be a slightly lower than \( p^\star \) (the actual optimum).</li>
</ul>

<p>Parameters (for a detailed description see <a href="../ref/usage.html">Usage</a> and <a href="../ref/admm.html">ADMM</a>)</p>

<ul>
  <li><code>T rho</code> is the penalty term.</li>
  <li><code>T rel_tol, abs_tol</code> are the absolute and relative stopping tolerances.</li>
  <li><code>unsigned int max_iter</code> is the maximum number of iterations before the solver terminates.</li>
  <li><code>bool quiet</code> determines whether the solver should display progress information.</li>
  <li><code>bool adaptive_rho</code> determines whether \( \rho \) should be chosen adaptively.</li>
</ul>

<p>Factors (allocate space for these variables to use factorization caching – see <a href="../ref/usage.html">Usage</a>)</p>

<ul>
  <li><code>M factors</code> used for factorization caching. Allocate space using <code>AllocDenseFactors</code> and free space using <code>FreeDenseFactors</code>.</li>
</ul>

<h3 id="functionobj">FunctionObj</h3>

<p>The <code>FunctionObj</code> struct is a parameterization of the generic function
\[
  c \, h(a \, x - b) + d \, x + e \, x ^ 2,
\]</p>

<p>and is defined as</p>

<pre><code class="language-cpp">template &lt;typename T&gt;
struct FunctionObj {
  // Parameters
  Function h;
  T a, b, c, d, e;

  // Constructor with defaults
  FunctionObj(Function h) : h(h), a(1), b(0), c(1), d(0), e(0) { }
};
</code></pre>
<p>where <code>Function</code> is an enum, taking on the values</p>

<pre><code>kAbs,      kExp,     kHuber,   kIdentity, kIndBox01, kIndEq0,  kIndGe0,  kIndLe0,
kLogistic, kMaxNeg0, kMaxPos0, kNegEntr,  kNegLog,   kRecipr,  kSquare,  kZero.
</code></pre>

<p>Definitions of both <code>FunctionObj</code> and <code>Function</code> are located in <code>&lt;pogs&gt;/src/prox_lib.h</code>.</p>

<p>The <code>FunctionObj</code> is necessary when specifying the objective terms \( f_i(y_i) \) and \( g_j(x_j) \). For example, to specify that \(g_j(x_j) = |x_j|\) for \(j = 1\ldots 4\) and \(g_5(x_5) = I(x_5 = 0)\), use the syntax </p>

<pre><code class="language-cpp">pogs_data.g.reserve(5);
for (unsigned int i = 0; i &lt; 4; ++i)
  pogs_data.g.push_back(FunctionObj(kAbs));
pogs_data.g.push_back(FunctionObj(kIndGe0));
</code></pre>

<h3 id="linking-to-cpu-implementation">Linking to CPU implementation</h3>

<p>Open Terminal and navigate to the directory <code>&lt;pogs&gt;/src</code>, then execute the command</p>

<pre><code>make pogs.o
</code></pre>

<p>This creates an object file <code>pogs.o</code>, to which your code must be linked. An example can be found in <code>&lt;pogs&gt;/examples/cpp/Makefile</code>. Look for the section marked <code>#CPU</code>. When compiling your code it is important to also link to a BLAS library. On an Apple computer this can be done using the flag <code>-framework Accelerate</code>.</p>

<h3 id="linking-to-gpu-implementation">Linking to GPU implementation</h3>

<p>Open terminal and navigate to the directory <code>&lt;pogs&gt;/src</code>, then execute the command</p>

<pre><code>make pogs_cu_link.o
</code></pre>

<p>This creates two object files – <code>pogs_cu.o</code> and <code>pogs_cu_link.o</code> – to which your code must be linked. An example can be found in <code>&lt;pogs&gt;/examples/cpp/Makefile</code>. Look for the section marked <code>#GPU</code>. You will need to link the the CUDA runtime and CuBLAS libraries. To do so, use the <code>-lcudart -lcublas</code> flags.</p>



                    </div>
                
            </div>

            <div class=row-fluid>
                <div id=footer class=span12>
                    Documentation for <a href="https://github.com/foges/pogs">POGS</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
    </body>
</html>
